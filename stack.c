#include<stdio.h>
#include<stdlib.h>

void do_hack(void)
{
	printf("Stack compromized :)\n");
	exit(98);
}
int add(int x,int y)
{
	register long rsp asm("rsp");
	register long rbp asm("rbp");
	int c;
	c=x+y;
	printf("func1, a = %d\n", *(int *)(rbp - 0x14) );
    printf("func1, b = %d\n", *(int *)(rbp - 0x18) );
    printf("func1, c = %d\n", *(int *)(rbp - 0x4) );
    printf("func1, previous rbp value = %lx\n", *(unsigned long int *)rbp );
    printf("func1, return address value = %lx\n", *(unsigned long int *)(rbp + 8) );
    /* hack the stack! */
     *(unsigned long int *)((char *)rbp + 8) = 0x0000555555555189;
    printf("func1, changed return address value = %lx\n", *(unsigned long int *)(rbp + 8) );
	return c;
}
int main(void)
{
	register long rsp asm("rsp");
	register long rbp asm("rbp");
	int a=10,b=2;
	int c;
	c=add(a,b);
	printf("sum is:%d\n",c);
	printf("<<main>> RBP:%lx\n",rbp);
	printf("<<main>> RSP:%lx\n",rsp);
	return 0;
}

/*#include <stdio.h>
#include <stdlib.h>

void bye(void)
{
    printf("[x] I am in the function bye!\n");
    exit(98);
}

void func1(void)
{
    int a;
    int b;
    int c;
    register long rsp asm ("rsp");
    register long rbp asm ("rbp");

    a = 98;
    b = 972;
    c = a + b;
    printf("a = %d, b = %d, c = %d\n", a, b, c);
    printf("func1, rpb = %lx\n", rbp);
    printf("func1, rsp = %lx\n", rsp);
    printf("func1, a = %d\n", *(int *)(((char *)rbp) - 0xc) );
    printf("func1, b = %d\n", *(int *)(((char *)rbp) - 0x8) );
    printf("func1, c = %d\n", *(int *)(((char *)rbp) - 0x4) );
    printf("func1, previous rbp value = %lx\n", *(unsigned long int *)rbp );
    printf("func1, return address value = %lx\n", *(unsigned long int *)((char *)rbp + 8) );
    /* hack the stack! */
   // *(unsigned long int *)((char *)rbp + 8) = 0x0000555555555189;
    //printf("func1, changed return address value = %lx\n", *(unsigned long int *)((char *)rbp + 8) );
//}

/*void func2(void)
{
    int a;
    int b;
    int c;
    register long rsp asm ("rsp");
    register long rbp asm ("rbp");

    printf("func2, a = %d, b = %d, c = %d\n", a, b, c);
    printf("func2, rpb = %lx\n", rbp);
    printf("func2, rsp = %lx\n", rsp);
}

int main(void)
{
    register long rsp asm ("rsp");
    register long rbp asm ("rbp");

    printf("main, rpb = %lx\n", rbp);
    printf("main, rsp = %lx\n", rsp);
    func1();
    func2();
    return (0);
}*/